<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ArcGIS GeometryEngine Tutorial</title>
    <script src="https://js.arcgis.com/4.24/"></script>
    <style>
      html,
      body,
      #viewDiv {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        background: white;
        padding: 10px;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <h3>GeometryEngine Relation Check</h3>
      <button id="chkButton">Check Relations</button>
      <p id="output"></p>
    </div>
    <div id="viewDiv"></div>

    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/geometry/Polygon",
        "esri/geometry/geometryEngine",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
      ], function (
        Map,
        MapView,
        Polygon,
        geometryEngine,
        GraphicsLayer,
        Graphic
      ) {
        const map = new Map({ basemap: "streets-navigation-vector" });
        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [100.5018, 13.7563],
          zoom: 12,
        });

        const polygonSymbol = {
          type: "simple-fill", // autocasts as new SimpleFillSymbol()
          color: [227, 139, 79, 0.8],
          outline: {
            // autocasts as new SimpleLineSymbol()
            color: [255, 255, 255],
            width: 1,
          },
        };

        // สร้าง GraphicsLayer เพื่อใส่ Graphic
        const graphicsLayer = new GraphicsLayer();
        map.add(graphicsLayer);

        // Define two polygons
        const polygon1Geometry = {
          type: "polygon", // autocasts as new Polygon()
          rings: [
            [100.49, 13.75],
            [100.52, 13.75],
            [100.52, 13.77],
            [100.49, 13.77],
            [100.49, 13.75],
          ],
          spatialReference: { wkid: 4326 },
        };
        const polygon1 = new Graphic({
          geometry: polygon1Geometry,
          symbol: polygonSymbol,
        });
        graphicsLayer.add(polygon1);
        const polygon2Geometry = {
          type: "polygon", // autocasts as new Polygon()
          rings: [
            [100.5, 13.76],
            [100.53, 13.76],
            [100.53, 13.78],
            [100.5, 13.78],
            [100.5, 13.76],
          ],
          spatialReference: { wkid: 4326 },
        };
        const polygon2 = new Graphic({
          geometry: polygon2Geometry,
          symbol: polygonSymbol,
        });
        graphicsLayer.add(polygon2);

        function checkRelations() {
          const intersects = geometryEngine.intersects(
            polygon1.geometry,
            polygon2.geometry
          );
          console.log("intersects", intersects);
          const contains = geometryEngine.contains(
            polygon1.geometry,
            polygon2.geometry
          );
          const within = geometryEngine.within(
            polygon1.geometry,
            polygon2.geometry
          );
          const crosses = geometryEngine.crosses(
            polygon1.geometry,
            polygon2.geometry
          );
          const unionResult = geometryEngine.union([
            polygon1.geometry,
            polygon2.geometry,
          ]);

          document.getElementById("output").innerHTML = `
                    <strong>Geometry Relations:</strong><br>
                    Intersects: ${intersects}<br>
                    Contains: ${contains}<br>
                    Within: ${within}<br>
                    Crosses: ${crosses}<br>
                    Union Area: ${
                      unionResult
                        ? unionResult.extent.width * unionResult.extent.height
                        : "N/A"
                    }
                `;
        }

        document
          .getElementById("chkButton")
          .addEventListener("click", checkRelations);
      });
    </script>
  </body>
</html>
